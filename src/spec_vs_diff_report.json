{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-16T05:28:59.122Z",
  "summary": "REQ-16/17/18 appear largely implemented (new Background and Text & Branding control panels, overlay/background renderers, and a WebGL 3D tunnel mode with WebGL support fallback + cleanup hooks). REQ-19 (in-browser MP4 export via ffmpeg.wasm with queue/progress) is not implemented; Export UI still shows a “coming soon” flow and the ffmpeg client throws an error. REQ-20 persistence is only partially implemented: backend types/migration were added, but the frontend encoding/loading logic does not appear to correctly round-trip the new settings (it passes non-JSON fields into deserializers and does not persist most background/overlay details like gradient stops, particles settings, or uploaded images/logos).",
  "missing_requirements": [
    {
      "id": "REQ-19",
      "requirement": "Replace the placeholder Export panel with functional in-browser MP4 export (ffmpeg.wasm), including resolution/FPS/bitrate controls, time+size estimates, progress indicator, and a client-side sequential render queue with cancel/status/error handling.",
      "reason": "ExportPanel still displays an in-development message and handleExport only shows a toast; ffmpeg client is explicitly a placeholder that throws an error stating FFmpeg.wasm is not available; queue store exists but is not wired into UI/flow.",
      "evidence": [
        "frontend/src/features/export/ExportPanel.tsx",
        "frontend/src/features/export/ffmpeg/ffmpegClient.ts",
        "frontend/src/features/export/useExportQueue.ts",
        "frontend/src/features/export/exportRenderer.ts"
      ]
    },
    {
      "id": "REQ-20",
      "requirement": "Persist all newly-enabled settings (Background, Text & Branding, and 3D Tunnel mode/settings) in Projects so Save/Load restores the same preview configuration.",
      "reason": "Although backend Project model adds backgroundSettings/brandingSettings/tunnelSettings and a migration exists, the frontend load/apply logic appears incorrect: it calls background deserialize with project.backgroundSettings.style (a style/type string, not serialized JSON), overlay deserialize with project.brandingSettings.font (a font string), and visualizer deserialize with project.tunnelSettings.mode (a mode string). Additionally, encoding functions only map a subset of settings and do not include key Background/Overlay details such as multi-stop gradient stops/angle, particles parameters, image background URL/file, or logo file/url.",
      "evidence": [
        "backend/main.mo",
        "backend/migration.mo",
        "frontend/src/features/persistence/applyLoadedProject.ts",
        "frontend/src/features/persistence/projectSettingsCodec.ts",
        "frontend/src/features/background/useBackgroundSettings.ts",
        "frontend/src/features/overlays/useOverlaySettings.ts",
        "frontend/src/features/app-shell/TopBar.tsx"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Profile setup modal prompting for user name after login (new onboarding/profile flow).",
      "reason": "Not requested by REQ-16..REQ-20; BuildRequest focuses on enabling Coming Soon options and persistence for background/overlays/tunnel/export.",
      "evidence": [
        "frontend/src/features/auth/ProfileSetupModal.tsx",
        "frontend-file-summaries.txt"
      ]
    },
    {
      "description": "Added/expanded marketing Landing Page content (hero/features/pricing/FAQ/CTA) unrelated to the Coming Soon feature unlock work.",
      "reason": "Not requested by REQ-16..REQ-20.",
      "evidence": [
        "frontend-file-summaries.txt (frontend/src/pages/LandingPage.tsx summary)"
      ]
    },
    {
      "description": "Imported multiple Google Fonts via CSS (@import) rather than strictly using bundled fonts.",
      "reason": "REQ-17 asks for font selection from bundled fonts; the diff shows loading fonts from Google Fonts which is an unrequested change and may contradict the “bundled fonts” intent.",
      "evidence": [
        "frontend/src/index.css"
      ]
    }
  ],
  "confidence": 0.78,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/App.tsx",
    "frontend/src/features/app-shell/SidebarNav.tsx",
    "frontend/src/features/app-shell/TopBar.tsx",
    "frontend/src/features/auth/ProfileSetupModal.tsx",
    "frontend/src/features/background/BackgroundControlsPanel.tsx",
    "frontend/src/features/background/backgroundRenderers.ts",
    "frontend/src/features/background/particlesOverlay.ts",
    "frontend/src/features/background/useBackgroundSettings.ts",
    "frontend/src/features/export/ExportPanel.tsx",
    "frontend/src/features/export/exportEstimator.ts",
    "frontend/src/features/export/exportRenderer.ts",
    "frontend/src/features/export/ffmpeg/ffmpegClient.ts",
    "frontend/src/features/export/useExportQueue.ts",
    "frontend/src/features/overlays/OverlaysControlsPanel.tsx",
    "frontend/src/features/overlays/overlayRenderers.ts",
    "frontend/src/features/overlays/useOverlaySettings.ts",
    "frontend/src/features/persistence/applyLoadedProject.ts",
    "frontend/src/features/persistence/projectSettingsCodec.ts",
    "frontend/src/features/projects/ProjectsPanel.tsx",
    "frontend/src/features/projects/useCurrentProject.ts",
    "frontend/src/features/visualizer/VisualizerControlsPanel.tsx",
    "frontend/src/features/visualizer/VisualizerEngine.ts",
    "frontend/src/features/visualizer/modes/Tunnel3DWebGL.ts",
    "frontend/src/features/visualizer/useVisualizerEngine.ts",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/index.css",
    "project_state.json"
  ]
}